<div class="max-w-2xl mx-auto">
  <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
    <div class="bg-gradient-to-r from-gray-50 to-blue-50 px-6 py-4 border-b border-gray-200">
      <div class="flex items-center space-x-3">
        <div class="w-8 h-8 bg-gradient-to-br from-tech to-accent rounded-lg flex items-center justify-center">
          <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m0 0a2 2 0 012 2v6a2 2 0 01-2 2H9a2 2 0 01-2-2V9a2 2 0 012-2m0 0V7a2 2 0 012-2m3 0a2 2 0 00-2-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
          </svg>
        </div>
        <div>
          <h2 class="text-xl font-semibold text-gray-800">修改密码</h2>
          <p class="text-sm text-gray-600 mt-1">更改您的登录密码</p>
        </div>
      </div>
    </div>

    <div class="p-6">
      <% if @error %>
        <div class="mb-4 p-4 bg-red-50 border border-red-200 rounded-lg">
          <div class="flex items-center">
            <svg class="w-5 h-5 text-red-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <span class="text-red-700"><%= @error %></span>
          </div>
        </div>
      <% end %>

      <% if @success %>
        <div class="mb-4 p-4 bg-green-50 border border-green-200 rounded-lg">
          <div class="flex items-center">
            <svg class="w-5 h-5 text-green-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
            </svg>
            <span class="text-green-700"><%= @success %></span>
          </div>
        </div>
      <% end %>

      <form method="post" action="/admin/change-password" class="space-y-6">
        <div>
          <label for="current_password" class="block text-sm font-medium text-gray-700 mb-2">
            当前密码 <span class="text-red-500">*</span>
          </label>
          <div class="relative">
            <input type="password"
                   id="current_password"
                   name="current_password"
                   required
                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-tech focus:border-tech transition-colors"
                   placeholder="请输入当前密码">
            <div class="absolute inset-y-0 right-0 pr-3 flex items-center">
              <button type="button" onclick="togglePassword('current_password')" class="text-gray-400 hover:text-gray-600">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                </svg>
              </button>
            </div>
          </div>
        </div>

        <div>
          <label for="new_password" class="block text-sm font-medium text-gray-700 mb-2">
            新密码 <span class="text-red-500">*</span>
          </label>
          <div class="relative">
            <input type="password"
                   id="new_password"
                   name="new_password"
                   required
                   minlength="6"
                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-tech focus:border-tech transition-colors"
                   placeholder="请输入新密码（至少6位）">
            <div class="absolute inset-y-0 right-0 pr-3 flex items-center">
              <button type="button" onclick="togglePassword('new_password')" class="text-gray-400 hover:text-gray-600">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                </svg>
              </button>
            </div>
          </div>
          <p class="mt-1 text-xs text-gray-500">密码长度至少6位，建议包含字母、数字和特殊字符</p>
        </div>

        <div>
          <label for="confirm_password" class="block text-sm font-medium text-gray-700 mb-2">
            确认新密码 <span class="text-red-500">*</span>
          </label>
          <div class="relative">
            <input type="password"
                   id="confirm_password"
                   name="confirm_password"
                   required
                   minlength="6"
                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-tech focus:border-tech transition-colors"
                   placeholder="请再次输入新密码">
            <div class="absolute inset-y-0 right-0 pr-3 flex items-center">
              <button type="button" onclick="togglePassword('confirm_password')" class="text-gray-400 hover:text-gray-600">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                </svg>
              </button>
            </div>
          </div>
        </div>

        <div class="flex items-center justify-between pt-4">
          <a href="/admin/dashboard" class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
            </svg>
            返回仪表板
          </a>
          <button type="submit" class="inline-flex items-center px-6 py-2 bg-gradient-to-r from-tech to-accent text-white text-sm font-medium rounded-lg hover:from-tech/90 hover:to-accent/90 transition-all duration-200 shadow-md hover:shadow-lg">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
            </svg>
            修改密码
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- 安全提示 -->
  <div class="mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4">
    <div class="flex items-start">
      <svg class="w-5 h-5 text-blue-500 mt-0.5 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
      </svg>
      <div>
        <h3 class="text-sm font-medium text-blue-800 mb-1">安全提示</h3>
        <ul class="text-sm text-blue-700 space-y-1">
          <li>• 建议使用强密码，包含大小写字母、数字和特殊字符</li>
          <li>• 定期更换密码，避免使用过于简单的密码</li>
          <li>• 不要在公共场所或不安全的网络环境下修改密码</li>
          <li>• 修改密码后，请妥善保管新密码</li>
        </ul>
      </div>
    </div>
  </div>
</div>

<script>
function togglePassword(fieldId) {
  const field = document.getElementById(fieldId);
  const type = field.getAttribute('type') === 'password' ? 'text' : 'password';
  field.setAttribute('type', type);
}

// 密码强度检查
document.getElementById('new_password').addEventListener('input', function() {
  const password = this.value;
  const strengthIndicator = document.getElementById('password-strength');

  if (password.length === 0) {
    if (strengthIndicator) strengthIndicator.remove();
    return;
  }

  let strength = 0;
  let strengthText = '';
  let strengthColor = '';

  // 长度检查
  if (password.length >= 6) strength++;
  if (password.length >= 8) strength++;

  // 复杂度检查
  if (/[a-z]/.test(password)) strength++;
  if (/[A-Z]/.test(password)) strength++;
  if (/[0-9]/.test(password)) strength++;
  if (/[^A-Za-z0-9]/.test(password)) strength++;

  if (strength <= 2) {
    strengthText = '弱';
    strengthColor = 'text-red-600 bg-red-100';
  } else if (strength <= 4) {
    strengthText = '中等';
    strengthColor = 'text-yellow-600 bg-yellow-100';
  } else {
    strengthText = '强';
    strengthColor = 'text-green-600 bg-green-100';
  }

  // 显示强度指示器
  let indicator = document.getElementById('password-strength');
  if (!indicator) {
    indicator = document.createElement('div');
    indicator.id = 'password-strength';
    indicator.className = 'mt-1 text-xs px-2 py-1 rounded inline-block';
    this.parentNode.parentNode.appendChild(indicator);
  }

  indicator.className = `mt-1 text-xs px-2 py-1 rounded inline-block ${strengthColor}`;
  indicator.textContent = `密码强度: ${strengthText}`;
});

// 确认密码匹配检查
document.getElementById('confirm_password').addEventListener('input', function() {
  const newPassword = document.getElementById('new_password').value;
  const confirmPassword = this.value;

  let indicator = document.getElementById('password-match');
  if (!indicator) {
    indicator = document.createElement('div');
    indicator.id = 'password-match';
    indicator.className = 'mt-1 text-xs';
    this.parentNode.parentNode.appendChild(indicator);
  }

  if (confirmPassword.length === 0) {
    indicator.textContent = '';
    return;
  }

  if (newPassword === confirmPassword) {
    indicator.className = 'mt-1 text-xs text-green-600';
    indicator.textContent = '✓ 密码匹配';
  } else {
    indicator.className = 'mt-1 text-xs text-red-600';
    indicator.textContent = '✗ 密码不匹配';
  }
});
</script>